
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculateur Albion - Wheat & Soup</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Babel pour le support JSX/TS dans le navigateur -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Metamorphous&family=MedievalSharp&family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a120b;
            color: #d9c5a0;
            margin: 0;
            padding: 0;
            background-image: url('https://www.transparenttextures.com/patterns/dark-leather.png');
        }
        .medieval-font { font-family: 'MedievalSharp', cursive; }
        .parchment-font { font-family: 'Metamorphous', serif; }
        .parchment-texture {
            background-color: #f4e4bc;
            background-image: url("https://www.transparenttextures.com/patterns/recycled-paper.png");
            box-shadow: inset 0 0 100px rgba(0,0,0,0.1), 15px 15px 40px rgba(0,0,0,0.6);
            border: 12px solid #3d2b1f;
        }
        .wood-input {
            background-color: #2d1f14;
            border: 2px solid #3d2b1f;
            color: #f4e4bc;
            transition: all 0.2s;
        }
        .wood-input:focus {
            border-color: #c5a059;
            box-shadow: 0 0 15px rgba(197, 160, 89, 0.2);
            outline: none;
        }
        ::-webkit-scrollbar { width: 10px; }
        ::-webkit-scrollbar-track { background: #1a120b; }
        ::-webkit-scrollbar-thumb { background: #3d2b1f; border: 2px solid #1a120b; }
    </style>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.3",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/",
    "react/": "https://esm.sh/react@^19.2.3/"
  }
}
</script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo } = React;

        const SEEDS_TOTAL = 144;

        const InputGroup = ({ label, value, onChange, unit, max }) => (
            <div className="flex flex-col gap-2.5">
                <label className="text-[10px] font-bold text-[#8b6d31] uppercase tracking-wider">{label}</label>
                <div className="relative">
                    <input 
                        type="number"
                        value={value}
                        onChange={(e) => {
                            const val = parseFloat(e.target.value) || 0;
                            if (max !== undefined && val > max) onChange(max);
                            else onChange(val);
                        }}
                        className="w-full wood-input rounded-sm py-3 px-4 text-base font-bold"
                    />
                    <span className="absolute right-4 top-1/2 -translate-y-1/2 text-[9px] font-black text-[#8b6d31] uppercase opacity-60">
                        {unit}
                    </span>
                </div>
            </div>
        );

        const App = () => {
            const [farming, setFarming] = useState({
                seedPrice: 2500,
                seedsRecovered: 126,
                wheatHarvested: 860,
                marketWheatPrice: 480,
            });

            const [crafting, setCrafting] = useState({
                wheatPerCraft: 16,
                foodPerCraft: 10,
                returnRate: 15,
                wheatPriceUsed: 480,
            });

            const results = useMemo(() => {
                // Section 3 - Calculs Farming
                const seedsBought = Math.max(0, SEEDS_TOTAL - farming.seedsRecovered);
                const realCycleCost = seedsBought * farming.seedPrice;
                const costPerWheat = farming.wheatHarvested > 0 ? realCycleCost / farming.wheatHarvested : 0;
                const diffMarket = farming.marketWheatPrice - costPerWheat;
                const isFarmingProfitable = costPerWheat < farming.marketWheatPrice;

                // Section 4 - Calculs Food
                const effectiveWheatConsumed = crafting.wheatPerCraft * (1 - (crafting.returnRate / 100));
                const realCraftCost = effectiveWheatConsumed * crafting.wheatPriceUsed;
                const costPerFood = crafting.foodPerCraft > 0 ? realCraftCost / crafting.foodPerCraft : 0;

                return {
                    seedsBought,
                    realCycleCost: Math.round(realCycleCost),
                    costPerWheat: Math.round(costPerWheat),
                    diffMarket: Math.round(diffMarket),
                    isFarmingProfitable,
                    effectiveWheatConsumed: Number(effectiveWheatConsumed.toFixed(2)),
                    realCraftCost: Math.round(realCraftCost),
                    costPerFood: Math.round(costPerFood)
                };
            }, [farming, crafting]);

            const bindWheatPrice = () => {
                setCrafting(prev => ({ ...prev, wheatPriceUsed: results.costPerWheat }));
            };

            return (
                <div className="min-h-screen pb-16 selection:bg-[#c5a059] selection:text-[#1a120b]">
                    <header className="bg-[#2d1f14] border-b-4 border-[#3d2b1f] py-6 px-6 shadow-2xl relative overflow-hidden">
                        <div className="max-w-6xl mx-auto flex flex-col md:flex-row items-center justify-between gap-6 relative z-10">
                            <div className="flex items-center gap-6">
                                <div className="bg-[#c5a059] p-3 rounded-sm border-2 border-[#8b6d31] shadow-[0_0_20px_rgba(197,160,89,0.3)]">
                                    <svg xmlns="http://www.w3.org/2000/svg" className="h-8 w-8 text-[#1a120b]" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
                                    </svg>
                                </div>
                                <div>
                                    <h1 className="medieval-font text-3xl font-bold text-[#c5a059] tracking-widest uppercase">Économe d'Albion</h1>
                                    <p className="text-[#8b6d31] text-[9px] font-bold tracking-[0.4em] uppercase mt-1 opacity-80">Calculateur Spécialisé - Blé & Soupe</p>
                                </div>
                            </div>
                        </div>
                    </header>

                    <main className="max-w-6xl mx-auto px-6 mt-10 grid grid-cols-1 lg:grid-cols-12 gap-10">
                        {/* ENTRÉES */}
                        <div className="lg:col-span-7 space-y-8">
                            {/* SECTION FARMING */}
                            <section className="bg-[#2d1f14] border-2 border-[#3d2b1f] p-6 rounded-sm shadow-xl">
                                <h2 className="medieval-font text-[#c5a059] text-xl mb-6 flex items-center gap-3 border-b border-[#3d2b1f] pb-3 uppercase tracking-wider">
                                    ▶ Farming
                                </h2>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <InputGroup label="Prix unitaire d’une graine (silver)" value={farming.seedPrice} onChange={(v) => setFarming({...farming, seedPrice: v})} unit="Silver" />
                                    <InputGroup label="Graines récupérées" value={farming.seedsRecovered} onChange={(v) => setFarming({...farming, seedsRecovered: v})} max={SEEDS_TOTAL} unit="u" />
                                    <InputGroup label="Blés récoltés" value={farming.wheatHarvested} onChange={(v) => setFarming({...farming, wheatHarvested: v})} unit="u" />
                                    <InputGroup label="Prix du blé sur le marché (silver)" value={farming.marketWheatPrice} onChange={(v) => setFarming({...farming, marketWheatPrice: v})} unit="Silver" />
                                </div>
                            </section>

                            {/* SECTION CRAFTING */}
                            <section className="bg-[#2d1f14] border-2 border-[#3d2b1f] p-6 rounded-sm shadow-xl">
                                <h2 className="medieval-font text-[#c5a059] text-xl mb-6 flex items-center gap-3 border-b border-[#3d2b1f] pb-3 uppercase tracking-wider">
                                    ▶ Crafting Food (Wheat Soup)
                                </h2>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div className="col-span-full mb-2">
                                        <div className="flex justify-between items-center mb-2">
                                            <label className="text-[10px] font-bold text-[#8b6d31] uppercase tracking-widest">Prix du blé utilisé pour le calcul</label>
                                            <button onClick={bindWheatPrice} className="text-[8px] bg-[#c5a059] text-[#1a120b] px-2 py-1 rounded-sm font-black hover:bg-white transition-colors uppercase">
                                                Utiliser coût de mon farming
                                            </button>
                                        </div>
                                        <input type="number" value={crafting.wheatPriceUsed} onChange={(e) => setCrafting({...crafting, wheatPriceUsed: parseFloat(e.target.value) || 0})} className="w-full wood-input rounded-sm py-3 px-4 text-base font-bold" />
                                    </div>
                                    <InputGroup label="Nombre de blés utilisés pour un craft" value={crafting.wheatPerCraft} onChange={(v) => setCrafting({...crafting, wheatPerCraft: v})} unit="u" />
                                    <InputGroup label="Nombre de foods obtenues par craft" value={crafting.foodPerCraft} onChange={(v) => setCrafting({...crafting, foodPerCraft: v})} unit="u" />
                                    <div className="md:col-span-2">
                                        <InputGroup label="Return rate de crafting (%)" value={crafting.returnRate} onChange={(v) => setCrafting({...crafting, returnRate: v})} unit="%" max={100} />
                                    </div>
                                </div>
                            </section>
                        </div>

                        {/* RÉSULTATS (Format de sortie obligatoire) */}
                        <div className="lg:col-span-5">
                            <div className="parchment-texture p-8 min-h-[800px] text-[#2a1e17] parchment-font flex flex-col">
                                
                                {/* FARMING RÉSUMÉ */}
                                <div className="mb-10">
                                    <div className="text-center mb-6">
                                        <h3 className="medieval-font text-2xl font-bold uppercase border-y-2 border-[#2a1e17]/20 py-1">FARMING – RÉSUMÉ</h3>
                                    </div>
                                    <div className="space-y-2 text-sm font-bold">
                                        <div className="flex justify-between"><span>Graines plantées :</span> <span>{SEEDS_TOTAL}</span></div>
                                        <div className="flex justify-between"><span>Graines récupérées :</span> <span>{farming.seedsRecovered}</span></div>
                                        <div className="flex justify-between"><span>Graines achetées :</span> <span>{results.seedsBought}</span></div>
                                        <div className="flex justify-between"><span>Prix graine :</span> <span>{farming.seedPrice} silver</span></div>
                                        <div className="flex justify-between border-t border-[#2a1e17]/20 pt-2 text-base">
                                            <span>Coût réel du cycle :</span> <span>{results.realCycleCost.toLocaleString()} silver</span>
                                        </div>
                                        
                                        <div className="pt-6 space-y-2">
                                            <div className="flex justify-between"><span>Blés récoltés :</span> <span>{farming.wheatHarvested}</span></div>
                                            <div className="flex justify-between text-blue-900"><span>Coût par blé :</span> <span>{results.costPerWheat} silver</span></div>
                                            <div className="flex justify-between"><span>Prix marché du blé :</span> <span>{farming.marketWheatPrice} silver</span></div>
                                            <div className="flex justify-between border-t border-[#2a1e17]/20 pt-2">
                                                <span>Différence :</span> <span>{results.diffMarket} silver / blé</span>
                                            </div>
                                            <div className={`mt-4 py-2 text-center text-sm uppercase tracking-widest border-2 ${results.isFarmingProfitable ? 'bg-green-800/10 border-green-800/40 text-green-800' : 'bg-red-800/10 border-red-800/40 text-red-800'}`}>
                                                Conclusion : {results.isFarmingProfitable ? 'Farming rentable' : 'Farming non rentable'}
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                {/* CRAFT FOOD RÉSUMÉ */}
                                <div>
                                    <div className="text-center mb-6">
                                        <h3 className="medieval-font text-2xl font-bold uppercase border-y-2 border-[#2a1e17]/20 py-1">CRAFT FOOD – WHEAT SOUP</h3>
                                    </div>
                                    <div className="space-y-2 text-sm font-bold">
                                        <div className="flex justify-between"><span>Blés utilisés :</span> <span>{crafting.wheatPerCraft}</span></div>
                                        <div className="flex justify-between"><span>Return rate :</span> <span>{crafting.returnRate} %</span></div>
                                        <div className="flex justify-between text-blue-900"><span>Blés effectivement consommés :</span> <span>{results.effectiveWheatConsumed}</span></div>
                                        
                                        <div className="pt-6 space-y-2">
                                            <div className="flex justify-between"><span>Foods obtenues :</span> <span>{crafting.foodPerCraft}</span></div>
                                            <div className="flex justify-between"><span>Coût réel du craft :</span> <span>{results.realCraftCost.toLocaleString()} silver</span></div>
                                            <div className="flex justify-between border-t-2 border-[#2a1e17]/20 pt-2 text-lg text-[#5c4033]">
                                                <span>Coût de revient par food :</span> <span>{results.costPerFood.toLocaleString()} silver</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div className="mt-auto pt-10 text-center opacity-30 select-none">
                                    <div className="inline-block p-4 border-4 border-[#8b4513] rounded-full medieval-font text-xs font-bold text-[#8b4513] rotate-[-10deg] uppercase tracking-widest">
                                        Officiel Albion
                                    </div>
                                </div>
                            </div>
                        </div>
                    </main>
                    <footer className="max-w-6xl mx-auto px-6 mt-12 text-center pb-8">
                        <p className="text-[#3d2b1f] text-[9px] font-bold uppercase tracking-[0.5em]">Calculs exacts selon Section 3 & 4 du protocole</p>
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
